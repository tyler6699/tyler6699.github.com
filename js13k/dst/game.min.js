var e,h=[];function n(t,h){for(m=e.createBuffer(1,96e3,48e3),gainNode=e.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=e.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(e.destination),gainNode.gain.value=.05,s.start()}function a(t){return 2*Math.random()-1}function l(t){if(t>1e4)return null;var i=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(i,2)}function c(t){if(t>5e4)return null;var i=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(i,3)}function r(t){var i=1e4;if(t>i)return null;var e=(i-t)/i,s=Math.pow(e,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function o(t){if(t>2e4)return null;var i=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*i*i}function y(t){if(t>1e4)return null;var i=(1e4-t)/1e4;return Math.sin(.01*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*i*i}function x(){for(os of h)null!=os&&os.stop(0);for(d in h=[],data=[18,21,19,17,15,13,20,18,10,23,8,20,22,24,7,14,15,16,13,22,18,15,24,16,21,23,23,20,20],audio=new AudioContext,data)data[d]&&(gain=audio.createGain(),osc=audio.createOscillator(),h.push(osc),osc.connect(gain),gain.connect(audio.destination),osc.start(.4*d),osc.frequency.setValueAtTime(440*1.06**(13-data[d]),.4*d),osc.type="triangle",gain.gain.setValueAtTime(0,.4*d),gain.gain.setTargetAtTime(1e-4,.4*d+.38,.005),osc.stop(.4*d+.39))}function u(t,i){this.entity=new g(30,30,t,i,"view"),this.newPos=function(t,i){this.entity.x=parseInt(t.entity.x+t.entity.width/2-i.canvasHalfW),this.entity.y=parseInt(t.entity.y+t.entity.height/2-i.canvasHalfH-gt)}}function f(){this.maxTime=1e5,this.currentTime=this.maxTime,this.timeOver=!1,this.prevTime=this.maxTime,this.levelTimes=[],this.levelTime=0,this.tick=function(t){this.timeOver||(this.levelTime+=t,this.currentTime-=t,this.timeOver=this.currentTime<=0)},this.reset=function(){this.levelTime=0,this.currentTime=this.maxTime,this.prevTime=this.currentTime,this.timeOver=!1,this.levelTimes=[]},this.setStartTime=function(){console.log("Clock calcTime"),this.calcTime(),this.levelTime=0},this.calcTime=function(){this.levelTimes.length>0?this.currentTime=this.maxTime-this.levelTimes.reduce((t,i)=>t+i):this.currentTime=this.maxTime,console.log("Time Left: "+this.currentTime)}}function v(t,i,e){var s=e[2],h=R,a=0;this.entity=new g(25,25,t,i,s),this.entity.y+=4,this.maxLeft=t-e[0]-1,this.maxRight=t+e[1]+25+4,this.jumping=!1;var l=this.entity.y;this.update=function(t){ctx=At.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.fillStyle="RED",ctx.fillRect(this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore()},this.tick=function(t,i){this.checkDie(t,i),s==rt?this.moveSide2Side():s==ot||(s==yt?this.follow():s==xt?(this.follow(),this.jump()):s==ut&&(this.moveSide2Side(),this.jump()))},this.follow=function(){this.entity.x>mt.entity.x&&this.entity.x>=this.maxLeft?this.entity.x-=1:this.entity.x<mt.entity.x&&this.entity.x<=this.maxRight-this.entity.width&&(this.entity.x+=1)},this.moveSide2Side=function(){h==R?(this.entity.x+=1,this.entity.x>=this.maxRight&&(h=S)):(this.entity.x-=1,this.entity.x<=this.maxLeft&&(h=R))},this.jump=function(){mt.jumping&&!this.jumping&&this.entity.y==l?(this.jumping=!0,a=10):a>0?(this.entity.y-=a,a--):this.jumping&&a<=0&&(this.entity.y+=Wt,this.entity.y>l&&(this.jumping=!1,this.entity.y=l))},this.checkDie=function(t,i){Ht(t.entity,0,this.entity,10)&&(t.reset||(t.lives--,t.died=!0,i.gitUI.setScores=!0,n(lt,1)),t.reset=!0)}}function g(t,i,e,s,h){this.type=h,this.width=t,this.height=i,this.mhWidth=t/-2,this.mhHeight=i/-2,this.hWidth=t/2,this.hHeight=i/2,this.yOffset=0,this.angle=0,this.x=e,this.y=s,this.active=!0,this.update=function(){this.active&&(ctx=At.context,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.angle),ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.width,this.height),ctx.restore())}}function p(t,i,e,s){this.time=0,this.image=new Image,this.image.src=Pt,this.direction=e;var h,n,a=t.gethPower();s=s;i==ct&&(this.sx=30,this.sy=60,this.sw=8,this.sh=8,this.maxDuration=1,this.float=!0,this.floatAmount=3,this.grow=!0),e==S?h=t.entity.x-t.entity.hWidth:e==R&&(h=t.entity.x+t.entity.hWidth),n=t.entity.y+2*this.sh,this.entity=new g(this.sw,this.sh,h,n,i),this.tick=function(){this.entity.active&&(this.time+=.13,this.float&&(e==S?(this.entity.y-=this.floatAmount,this.entity.x-=this.floatAmount/2):e==R&&(this.entity.y-=this.floatAmount,this.entity.x+=this.floatAmount/2),this.grow&&(this.entity.width++,this.entity.height++),s?this.entity.x-=1.2*a:this.entity.x+=1.2*a),this.time>=this.maxDuration&&(this.entity.active=!1))},this.update=function(t){this.entity.active&&(ctx=At.context,ctx.save(),ctx.globalAlpha=.65,ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.drawImage(this.image,this.sx,this.sy,this.sw,this.sh,this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore())}}function w(){this.showLevel=!1,this.time=0,this.done=!1,this.setScores=!1,this.calculatedTime=!1,this.newRecord=!1,this.text1="",this.text2="",this.text3="",this.pressWait=0,this.maxWait=.3,this.update=function(t,e,s,h,n,a){this.calculatedTime||(null!=n.levelTimes[s.currentLevel]&&(n.currentTime=n.currentTime+n.levelTimes[s.currentLevel]),this.calculatedTime=!0),ctx=At.context,ctx.save(),ctx.translate(0,0),ctx.fillStyle="#1e606e",ctx.fillRect(40,60,t-90,e-90),ctx.fillStyle="#2d1b00",ctx.fillRect(50,70,t-110,e-110),ctx.restore(),ctx.save(),ctx.font="16px Monaco",ctx.fillStyle="#c4f0c2",Ct(ctx,[{text:"================= ",fillStyle:"#5ab9a8"},{text:"CarelessLabs"},{text:" ================= ",fillStyle:"#5ab9a8"}],60,95);var l=1,c=0;if(this.showLevel){for(this.text1="1. Back",ctx.fillText(this.text1,60,120+25*l+c),l++,i=0;i<a.levels.length;i++){l++;var r=null==n.levelTimes[i]?"Not Completed":n.levelTimes[i];ctx.fillText("Level: "+i+". "+r,60,120+25*l+c)}this.text1=""}else{""!=this.text1?(ctx.fillText(this.text1,60,120+25*l),l++,ctx.fillText(this.text2,60,120+25*l)):c-=25,""!=this.text3&&(l++,ctx.fillText(this.text3,60,120+25*l)),l+=2;var o=a.complete?s.currentLevel+1:s.currentLevel;a.complete&&s.currentLevel==a.levels.length-1&&(o=0),Ct(ctx,[{text:"::: MENU :::",fillStyle:"#5ab9a8"}],60,120+25*l+c),l++,ctx.fillText("1. Play level "+o,60,120+25*l+c),l++,ctx.fillText("2. Retry",60,120+25*l+c),l++,ctx.fillText("3. Level Select",60,120+25*l+c)}ctx.restore()},this.tick=function(t,i,e,s){this.setScores&&(this.setScores=!1,null==s||s.died||s.fell?(this.text2="",this.text3="",s.fell?this.text1="You fell to your death.":s.died&&(this.text1="Try not to die!")):(this.newRecord=!1,this.text1="",this.text2="             TIME: "+Xt(e.levelTime,3),this.text3="",!e.timeOver&&null==e.levelTimes[s.currentLevel]||e.levelTimes[s.currentLevel]>e.levelTime?(this.text1=" NEW RECORD LEVEL: "+s.currentLevel,this.newRecord=!0,null!=e.levelTimes[s.currentLevel]&&(this.text3="  PREVIOUS RECORD: "+Xt(e.levelTimes[s.currentLevel],3)),e.levelTimes[s.currentLevel]=e.levelTime):e.timeOver?(this.text1="Out of time!",this.text2=""):(this.newRecord=!1,this.text1="SLOWER TIME LEVEL: "+s.currentLevel,null!=e.levelTimes[s.currentLevel]&&(this.text3="   CURRENT RECORD: "+Xt(e.levelTimes[s.currentLevel],3)))),s.died=!1,s.fell=!1,console.log("UI calcTime"),e.calcTime(),e.timeOver=!1),this.done||(this.time+=t,this.pressWait-=t/1e3,At.keys&&!this.showLevel&&this.pressWait<=0?(At.keys[X]?(i.complete&&(s.currentLevel<i.levels.length-1?s.currentLevel++:s.currentLevel=0),this.done=!0,i.complete=!1,i.reset(s)):At.keys[C]?(i.complete=!1,this.done=!0,i.reset(s)):At.keys[Y]&&(this.showLevel=!0),(At.keys[X]||At.keys[C]||At.keys[Y])&&(this.pressWait=this.maxWait)):At.keys&&this.showLevel&&At.keys[X]&&(this.showLevel=!1,this.pressWait=this.maxWait))},this.reset=function(){this.calculatedTime=!1,this.done=!1,this.time=0}}function T(e,s,h,a,l,c){this.entity=new g(e,s,a,l,"hero"),this.maxLives=5,this.lives=5,this.died=!1,this.fell=!1,this.speed=1,this.color=h,this.startX=a,this.startY=l,this.currentLevel=0,this.prevLevel=null,this.active=!1,this.reset=!1,this.jumping=!1,this.onLadder=!1,this.exitLadder=!1,this.onLeftA=!1,this.onRightA=!1,this.image=new Image,this.image.src=Pt,this.fx=[];var r=0,o=0,y=!1,x=Wt,u=!1,d=!1,m=0,f=0;function v(){mt.hbX=mt.entity.x+mt.entity.hWidth,mt.hbY=mt.entity.y+mt.entity.hHeight/2}this.update=function(t){for(ctx=At.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.fillStyle="#196127",ctx.fillRect(this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore(),i=0;i<this.fx.length;i++){var e=this.fx[i];e.tick(),e.update(t),0==e.entity.active&&this.fx.splice(i,1)}},this.newPos=function(e,s){m=0;var h=this.entity.y,a=this.falling;x=this.onLadder&&!this.exitLadder?0:Wt,this.onLadder&&!this.exitLadder&&(o=0),this.hbX1=this.entity.x,this.hbY1=this.entity.y,v();var l=this.entity.x+r*this.speed,c=this.entity.y+x-o;this.onLeftA?(l-=3,r>3&&this.fx.length<10&&this.fx.push(new p(this,ct,S,!0))):this.onRightA&&(l+=3,r<-3&&this.fx.length<10&&this.fx.push(new p(this,ct,R,!0))),f>3.5&&(this.fx.push(new p(this,ct,R,!0)),this.fx.push(new p(this,ct,S,!0))),this.onLadder&&(u&&!this.exitLadder?(c-=3,u=!1,c+=o):d&&(c+=3,d=!1)),this.exitLadder=!1,o>0?o--:this.jumping=!1;var g=!0,w=!0;for(this.onLadder=!1,this.onLeftA=!1,this.onRightA=!1,i=0;i<e.length;i++)t=e[i],t.isSolid&&t.active&&Dt(l,this.hbY1,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(t.oneWay||(w=!1)),Dt(this.hbX1,c,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(t.isSolid&&t.active?t.oneWay?this.entity.y+this.entity.height<=t.entity.y&&(g=!1,this.jumping||(this.entity.y=t.entity.y-this.entity.height)):(g=!1,this.jumping||this.entity.y+this.entity.height<t.entity.y&&(this.entity.y=t.entity.y-this.entity.height)):t.type!=Q&&t.type!=Z||(this.onLadder=!0)),t.type==Z?Dt(this.hbX1,c+28,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.exitLadder=!0,m=t.entity.y-c):t.type==tt?Dt(this.hbX1,c+10,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.onLeftA=!0):t.type==it&&Dt(this.hbX1,c+10,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.onRightA=!0);y=!g,w&&(this.entity.x=l),g&&(this.entity.y=c),this.entity.y>700&&(s.gitUI.setScores=!0,n(nt,1),this.lives--,this.fell=!0,this.entity.y=this.startY,this.entity.x=this.startX,s.reset(),this.reset=!0),this.falling=this.entity.y!=h,this.falling!=a&&y&&0==o&&(this.fx.push(new p(this,ct,S,!1)),this.fx.push(new p(this,ct,R,!1))),this.onLadder||this.exitLadder||y?f=0:f+=.1},this.tick=function(){r>0?(r-=.3)<0&&(r=0):r<0&&(r+=.3)>0&&(r=0),At.keys&&!this.jumping&&(At.keys[W]||At.keys[I]||At.keys[U])&&this.moveUp(),At.keys&&(At.keys[A]||At.keys[M])&&this.onLadder&&(d=!0),At.keys&&(At.keys[S]||At.keys[P])&&r>-3&&r--,At.keys&&(At.keys[R]||At.keys[O])&&r<3&&r++,pt.length>0&&((pt[0].axes[0]<-.8||pt[0].axes[2]<-.8||pt[0].buttons[14].pressed)&&r>-3&&r--,(pt[0].axes[0]>.8||pt[0].axes[2]>.8||pt[0].buttons[15].pressed)&&r<3&&r++,(pt[0].axes[1]<-.8||pt[0].axes[3]<-.8||pt[0].buttons[12].pressed)&&this.moveUp(),(pt[0].axes[1]>.8||pt[0].axes[3]>.8||pt[0].buttons[13].pressed)&&this.onLadder&&(d=!0))},this.resetPos=function(t,i){this.startX=t,this.startY=i,this.entity.x=this.startX,this.entity.y=this.startY,v(),r=0,jumping=!1,o=0,this.active=!0,this.fx=[],f=0},this.updateHitbox=function(){v()},this.moveUp=function(){0==o&&(1==y||1==this.exitLadder&&m<=15)&&(this.jumping=!0,o=17,n(ht,1)),this.onLadder&&(u=!0)},this.gethPower=function(){return r},this.resetHero=function(){this.currentLevel=0,this.lives=this.maxLives}}function k(){this.update=function(t,i,e,s){ctx=At.context,ctx.save(),ctx.translate(0,0),ctx.fillStyle="#2d1b00",ctx.fillRect(0,0,t,40),ctx.restore(),ctx.save(),ctx.font="20px Verdana",ctx.fillStyle="#c4f0c2",Ct(ctx,[{text:"Lives: "},{text:i.lives,fillStyle:"#5ab9a8"}],10,28),i.active&&s.active?Ct(ctx,[{text:"Time: "},{text:Xt(e,2),fillStyle:"#5ab9a8"}],470,25):Ct(ctx,[{text:"Time: "},{text:"_._",fillStyle:"#5ab9a8"}],470,25),args=[{text:"Level: "},{text:i.currentLevel,fillStyle:"#5ab9a8"}],Ct(ctx,args,250,25),ctx.restore()}}function L(){this.done=!1,this.time=0,this.gitUI=new w,this.tick=function(t){ctx=At.context,ctx.font="30px Arial",Ct(ctx,[{text:"=========== ",fillStyle:"#5ab9a8"},{text:"CarelessLabs"},{text:" =========== ",fillStyle:"#5ab9a8"}],10,50),At.context.fillText("                     PRESS SPACE",10,300),At.keys&&At.keys[U]&&(null==e&&(e=new AudioContext),Lt=!0)},this.reset=function(){this.done=!1,this.time=0,this.gitUI.reset()},this.trans=function(t,e){if(this.time<70){var s=t/32,h=e/32;if(this.time<32)for(i=0;i<=s;i++)for(j=0;j<=h;j++)ctx=At.context,ctx.save(),ctx.translate(32*i,32*j),ctx.fillStyle="#1e606e",ctx.fillRect(this.time/2,this.time/2,32-this.time,32-this.time),ctx.restore();this.time+=2}else this.done=!0}}getSound=function(t,i){var e;switch(t){case et:e=a(i);break;case st:e=r(i);break;case ht:e=l(i);break;case nt:e=c(i);break;case at:e=o(i);break;case lt:e=y(i);break;default:return 1}return e};var S=37,R=39,W=38,A=40,I=87,P=65,M=83,O=68,H=0,D=2,U=32,X=49,C=50,Y=51,B=0,V=1,_=2,q=3,z=4,K=5,Q=6,Z=7,$=8,tt=9,it=10,et=0,st=1,ht=2,nt=3,at=4,lt=5,ct=0,rt=0,ot=1,yt=2,xt=3,ut=4;function dt(t,s,h){this.tiles=[],this.backTiles=[],this.coins=[],this.enemies=[],this.startX=0,this.startY=0,this.canvasHalfW=t/2,this.canvasHalfH=s/2,this.showPortal=!1,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;var a,l=0,c=0;this.draw=function(t,e){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update(e)}for(i=0;i<this.tiles.length;i++){this.tiles[i].update(e)}for(i=0;i<this.coins.length;i++){this.coins[i].update(e)}for(i=0;i<this.enemies.length;i++){this.enemies[i].update(e)}},this.tick=function(t,e,s){for(i=0;i<this.tiles.length;i++){this.tiles[i].tick(t)}for(i=0;i<this.enemies.length;i++){this.enemies[i].tick(t,e)}for(i=0;i<this.coins.length;i++){var h=this.coins[i];h.type==_&&Nt(h)&&this.active&&h.active?(n(st,1),h.active=!1,l++):h.type==$&&this.showPortal&&(h.active?h.active&&Nt(h)&&(s.prevTime=s.currentTime,e.gitUI.setScores=!0,n(at,1),this.showPortal=!1,this.complete=!0,t.active=!1,this.active=!1,t.currentLevel==this.maxLevels&&(t.currentLevel=-1),e.reset()):h.active=!0)}l!=c||t.reset?t.reset&&(this.showPortal=!1,t.reset=!1,t.active=!1,this.active=!1,e.reset(),this.reset(t)):this.showPortal=!0},this.reset=function(t){this.showPortal=!1,this.active=!1;var i=null!=t?t.currentLevel:0;c=0,l=0,this.tiles=[],this.backTiles=[],this.coins=[],this.enemies=[];var s=(a=this.levels[i]).length,h=a[0].length;for(row=0;row<s;row++)for(col=0;col<h;col++){var n;xx=30*col,yy=30*row;var r=a[row][col];[V,z,K,Q,Z,tt,it].includes(r)?(n=new Mt(30,xx,yy,r,!0,col,row),this.tiles.push(n)):r==_||r==$?(n=new Mt(30,xx,yy,r,!1,col,row),this.coins.push(n),r==_&&c++):r==q?(this.startX=xx,this.startY=yy):Array.isArray(r)&&this.enemies.push(new v(xx,yy,r)),Math.random()>.8&&(n=new Mt(30,xx,yy,B,!1,col,row),this.backTiles.push(n))}null!=t&&t.resetPos(this.startX,this.startY),null!=e&&x()},E=[60,60,rt],F=[60,30,rt],J=[30,30,ut],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.levels.push([[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,0,1,1,1,0,1,0,0],[0,1,0,0,0,1,0,1,0,1,0,0],[0,1,0,1,0,1,0,1,0,0,0,0],[0,1,1,1,0,1,1,1,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,2,0,0,2,0,0,2,0,0,8],[4,4,4,4,4,4,4,4,4,4,4,4]]),this.levels.push([N,N,[0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0],[0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0],[0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0],[0,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0],[0,3,0,0,0,1,0,0,0,1,0,0,0,8,0,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]),this.levels.push([N,N,[0,1,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0],[0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,1,0],[0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0],[0,1,1,0,1,1,0,1,0,1,0,1,0,1,1,1,0],N,[0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,6,1,4,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,6,1,0,0,0,0,0,0,0,0,0,0],[0,3,0,2,0,6,1,0,2,0,0,0,2,0,0,8,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]),E=[180,90,rt],this.levels.push([N,[0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,0],[0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0],[0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,0],[0,0,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,0],N,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,3,0,1,2,0,0,0,0,0,E,0,0,0,2,1,8,0,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]),E=[150,150,rt],F=[210,90,rt],this.levels.push([[2,0,0,0,0,0,0,0,0,0,0,2],[0,0,0,0,0,E,7,0,8,0,0,0],[1,1,1,1,1,1,6,1,1,1,1,1],[0,0,0,0,0,0,6,0,0,0,0,0],[2,0,0,7,0,0,6,0,7,0,0,2],[4,0,0,6,4,4,4,4,6,0,0,4],[0,0,0,6,0,0,0,0,6,0,0,0],[2,0,0,0,0,0,0,F,0,7,0,2],[4,4,4,4,4,4,4,4,4,6,4,4],[0,0,0,0,0,0,0,0,0,6,0,0],[3,0,0,0,0,0,0,0,0,6,0,0],[1,1,1,1,1,1,1,1,1,1,1,1]]),E=[60,0,rt],F=[60,0,rt],G=[120,120,rt],this.levels.push([[0,0,0,0,0,0,0,0,0,0,0,0],[2,0,E,0,0,0,0,7,0,8,F,2],[1,1,1,1,0,0,1,6,1,1,1,1],[0,0,0,0,0,0,0,6,0,0,0,0],[2,0,7,0,0,0,0,6,0,0,0,2],[4,4,6,0,4,4,4,4,4,0,4,4],[0,0,6,0,0,0,0,0,0,0,0,0],[2,0,6,0,G,0,0,0,0,7,0,2],[4,4,4,4,4,4,4,4,4,6,4,4],[0,0,0,0,0,0,0,0,0,6,0,0],[0,3,0,0,0,0,0,0,0,6,0,2],[1,1,1,1,1,1,1,1,1,1,1,1]]),this.levels.push([N,N,[0,5,0,5,5,5,0,5,5,5,0,0],[0,5,0,5,0,0,0,5,0,0,0,0],[0,5,0,5,0,0,0,5,5,0,0,0],[0,5,0,5,0,0,0,5,0,0,0,0],[0,5,0,5,5,5,0,5,5,5,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,3,0,2,2,2,2,2,2,0,8,0],[5,5,5,5,5,5,5,5,5,5,5,5],[1,1,1,1,1,1,1,1,1,1,1,1]]),this.levels.push([[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,2,0,0,0,0],[0,0,0,0,0,0,5,5,0,0,2,0],[0,8,0,0,0,0,0,0,0,5,5,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,5,5,4,4,4,5,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[5,5,2,0,0,0,0,0,0,2,0,7],[1,1,4,4,4,4,4,4,4,4,4,6],[0,0,0,0,0,0,0,0,0,0,0,6],[3,0,2,0,0,0,0,0,0,2,0,6],[1,1,5,5,5,5,5,5,5,5,1,1]]),this.levels.push([[7,0,0,0,2,0,0,0,0,0,0,0],[6,4,4,4,4,0,0,0,0,0,0,0],[6,0,0,0,0,0,0,0,0,0,0,0],[6,0,0,0,0,2,0,2,0,0,0,8],[6,0,0,0,0,5,0,5,0,1,4,4],[6,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7],[0,0,4,4,5,5,4,4,5,5,4,6],[0,0,0,0,0,0,0,0,0,0,0,6],[0,0,0,0,2,0,2,0,2,0,0,6],[3,0,0,0,0,0,0,0,0,0,0,6],[1,1,1,0,5,0,5,0,5,0,1,1]]),this.levels.push([[2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[5,0,7,0,0,0,0,0,0,0,8,0],[0,5,6,5,5,0,0,0,0,4,4,4],[0,0,6,0,0,0,0,0,0,0,0,2],[0,0,6,0,0,0,5,5,5,0,0,4],[2,3,0,0,0,0,0,0,0,0,0,2],[4,4,0,0,0,0,0,0,0,0,0,4],[0,0,5,0,0,0,0,0,0,0,0,2],[0,0,0,5,0,0,0,0,0,0,0,4],[0,2,0,0,5,5,0,0,0,0,0,2],[1,1,1,0,0,0,0,1,1,1,1,1]]),this.levels.push([[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,8,0],[0,3,0,0,2,2],[5,5,5,5,4,4]]),this.levels.push([[0,7,0,2,0,0],[0,6,1,1,0,0],[0,6,0,0,8,0],[0,3,0,0,0,0],[5,5,5,5,4,4]]),this.maxLevels=this.levels.count}var dt,mt,k,f,ft,vt=!1,gt=100,pt=[],wt=[],Tt=600,kt=400,Lt=!1,bt=Date.now(),St=Date.now(),Et=0,Rt=0,Wt=6;function startGame(){ft=new u(0,0),(dt=new dt(Tt,kt,1)).reset(null),mt=new T(25,25,"green",dt.startX,dt.startY),ft.newPos(mt,dt),L=new L,k=new k,f=new f,At.start()}var At={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Tt,this.canvas.height=kt,this.context=this.canvas.getContext("2d"),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[4]),this.frameNo=0,this.interval=setInterval(It,20),window.addEventListener("keydown",function(t){t.preventDefault(),At.keys=At.keys||[],At.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){At.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),At.keys=At.keys||[],At.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),At.keys=At.keys||[],At.keys[t.button]=!1}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){navigator.getGamepads()[t.gamepad.index];pt[t.gamepad.index]=t.gamepad})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function It(){bt=St,St=Date.now(),Et+=Rt=St-bt,navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,Lt?(At.clear(),dt.draw(mt,ft),L.done&&L.gitUI.done?(0==dt.active&&(dt.active=!0,f.setStartTime()),mt.tick(ft),mt.newPos(dt.tiles,L),dt.tick(mt,L,f),f.tick(Rt,f),mt.update(ft)):(L.gitUI.update(Tt,kt,mt,Rt,f,dt),L.trans(Tt,kt)),ft.newPos(mt,dt),k.update(Tt,mt,f.currentTime,dt),mt.lives<0&&(Lt=!1,f.reset(),mt.resetHero(),dt.reset(mt)),f.timeOver&&(mt.reset||(f.setStartTime(),L.gitUI.setScores=!0,mt.reset=!0)),L.gitUI.tick(Rt,dt,f,mt)):(At.clear(),L.tick(Rt))}var Pt="assets/atlas.png";function Mt(t,i,e,s,h,n,a){this.entity=new g(t,t,i,e,"tile"),this.isSolid=h,this.column=n,this.row=a,this.image=new Image,this.collected=!1,this.type=s,this.active=!0,this.time=0,this.oneWay=!1,this.leftPush=!1,this.rightPush=!1,this.image.src=Pt,this.draw=!0,this.sx=0,this.sy=0,this.sw=30,this.sh=30;switch(this.type){case V:this.sx=60;break;case _:this.sx=90;break;case Q:this.sy=60,this.isSolid=!1;break;case Z:this.draw=!1,this.isSolid=!1;break;case z:this.sx=120,this.oneWay=!0;break;case B:this.sy=30;break;case K:this.time=1,this.sx=30,this.sy=30;break;case $:this.sx=60,this.sy=30,this.active=!1;break;case tt:this.sx=0,this.sy=0,this.leftPush=!0;break;case it:this.sx=60,this.sy=30,this.rightPush=!0,this.entity.angle=2*Math.PI-180*Math.PI/180}this.update=function(t){ctx=At.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.rotate(this.entity.angle),this.setTileAlphas(),this.animBelt(),null==this.image?(ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.entity.width,this.entity.height)):this.active&&this.draw&&(this.type==K?ctx.drawImage(this.image,this.sx,this.entity.yOffset,this.sw,this.sh,this.entity.mhWidth,this.entity.mhHeight+this.entity.yOffset,this.entity.width,this.entity.height):ctx.drawImage(this.image,this.sx,this.sy,this.sw,this.sh-1,this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height)),ctx.restore()},this.tick=function(t){this.type==K&&(this.entity.yOffset>-30&&Ot(t,this)?(this.time-=.012,this.entity.yOffset-=.8):this.entity.yOffset<-30&&(this.active=!1))},this.animBelt=function(){this.type!=tt&&this.type!=it||!this.active||(this.time+=.01,this.time<.2?(this.sx=120,this.sy=30):this.time<.4?(this.sx=90,this.sy=30):(this.sx=0,this.sy=0),this.time>.6&&(this.time=0))},this.setTileAlphas=function(){this.type==$&&this.active?(this.time+=.001,ctx.globalAlpha=jt(this.time)):this.type==K&&(ctx.globalAlpha=this.time)}}function Ot(t,i){return null!=i.entity&&Dt(t.entity.x,t.entity.y+20,t.entity.width,t.entity.height,i.entity.x,i.entity.y,i.entity.width,i.entity.height)}function jt(t){return.5*(1+Math.sin(157*t))}function Nt(t){return mt.hbX<t.entity.x+t.entity.width&&mt.hbX>t.entity.x&&mt.hbY<t.entity.y+t.entity.height&&mt.hbY>t.entity.y}function Ht(t,i,e,s){return Dt(t.x+i/2,t.y+i/2,t.width-i,t.height-i,e.x+s/2,e.y+s/2,e.width-s,e.height-s)}function Dt(t,i,e,s,h,n,a,l){return t<h+a&&t+e>h&&i<n+l&&i+s>n}function Ut(t){return(t/1e3).toFixed(1)}function Xt(t,i){return(t/1e3).toFixed(i)}const Ct=(t,i,e,s)=>{let h=t.fillStyle,n=t.font;t.save(),i.forEach(({text:i,fillStyle:a,font:l})=>{t.fillStyle=a||h,t.font=l||n,t.fillText(i,e,s),e+=t.measureText(i).width}),t.restore()};