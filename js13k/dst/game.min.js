var e,n=[];function h(t,n){for(m=e.createBuffer(1,96e3,48e3),gainNode=e.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=e.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(e.destination),gainNode.gain.value=.05,s.start()}function a(t){return 2*Math.random()-1}function o(t){if(t>1e4)return null;var i=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(i,2)}function r(t){if(t>5e4)return null;var i=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(i,3)}function c(t){var i=1e4;if(t>i)return null;var e=(i-t)/i,s=Math.pow(e,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function y(t){if(t>2e4)return null;var i=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*i*i}function l(){for(os of n)null!=os&&os.stop(0);for(d in n=[],data=[12,12,11,11,11,10,10,10,11,11,11,12,12,12],audio=new AudioContext,data)data[d]&&(gain=audio.createGain(),osc=audio.createOscillator(),n.push(osc),osc.connect(gain),gain.connect(audio.destination),osc.start(.4*d),osc.frequency.setValueAtTime(440*1.06**(13-data[d]),.4*d),osc.type="triangle",gain.gain.setValueAtTime(0,.4*d),gain.gain.setTargetAtTime(1e-4,.4*d+.38,.005),osc.stop(.4*d+.39))}function u(t,i){this.entity=new g(30,30,"null",t,i,"view"),this.newPos=function(t,i){this.entity.x=parseInt(t.entity.x+t.entity.width/2-i.canvasHalfW),this.entity.y=t.entity.y+t.entity.height/2-i.canvasHalfH-Q}}function g(t,i,e,s,n,h){this.type=h,this.width=t,this.height=i,this.mhWidth=t/-2,this.mhHeight=i/-2,this.hWidth=t/2,this.hHeight=i/2,this.yOffset=0,this.angle=0,this.x=s,this.y=n,this.color=e,this.active=!0,this.update=function(){this.active&&(ctx=et.context,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.angle),ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.width,this.height),ctx.restore())}}function f(e,s,n,a,o,r){this.entity=new g(e,s,n,a,o,"hero"),this.speed=1,this.color=n,this.startX=a,this.startY=o,this.currentLevel=0,this.active=!1,this.reset=!1,this.jumping=!1,this.onLadder=!1,this.exitLadder=!1,this.onLeftA=!1,this.onRightA=!1;var c=0,y=0,d=!1,l=6,u=!1,f=!1;function v(){F.hbX=F.entity.x+F.entity.hWidth,F.hbY=F.entity.y+F.entity.hHeight/2}this.update=function(t){ctx=et.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.fillStyle=n,ctx.fillRect(this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore()},this.newPos=function(e){l=this.onLadder&&!this.exitLadder?0:6,this.hbX1=this.entity.x,this.hbY1=this.entity.y,v();var s=this.entity.x+c*this.speed,n=this.entity.y+l-y;this.onLeftA?s-=3:this.onRightA&&(s+=3),this.onLadder&&(u&&!this.exitLadder?(n-=3,u=!1,n+=y):f&&(n+=3,f=!1)),this.exitLadder=!1,y>0?y--:this.jumping=!1;var a=!0,o=!0;for(this.onLadder=!1,this.onLeftA=!1,this.onRightA=!1,i=0;i<e.length;i++)t=e[i],t.isSolid&&t.active&&vt(s,this.hbY1,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(t.oneWay||(o=!1)),vt(this.hbX1,n,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(t.isSolid&&t.active?t.oneWay?this.entity.y+this.entity.height<=t.entity.y&&(a=!1):a=!1:t.type!=O&&t.type!=C||(this.onLadder=!0)),t.type==C?vt(this.hbX1,n+30,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.exitLadder=!0):t.type==N?vt(this.hbX1,n+10,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.onLeftA=!0):t.type==j&&vt(this.hbX1,n+10,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.onRightA=!0);d=!a,o&&(this.entity.x=s),a&&(this.entity.y=n),this.entity.y>400&&(h(V,1),this.entity.y=this.startY,this.entity.x=this.startX,this.reset=!0)},this.tick=function(){c>0?(c-=.3)<0&&(c=0):c<0&&(c+=.3)>0&&(c=0),et.keys&&!this.jumping&&(et.keys[w]||et.keys[L]||et.keys[W])&&this.moveUp(),et.keys&&(et.keys[k]||et.keys[H])&&this.onLadder&&(f=!0),et.keys&&(et.keys[x]||et.keys[P])&&c>-3&&c--,et.keys&&(et.keys[p]||et.keys[X])&&c<3&&c++,Z.length>0&&((Z[0].axes[0]<-.8||Z[0].axes[2]<-.8||Z[0].buttons[14].pressed)&&c>-3&&c--,(Z[0].axes[0]>.8||Z[0].axes[2]>.8||Z[0].buttons[15].pressed)&&c<3&&c++,(Z[0].axes[1]<-.8||Z[0].axes[3]<-.8||Z[0].buttons[12].pressed)&&this.moveUp(),(Z[0].axes[1]>.8||Z[0].axes[3]>.8||Z[0].buttons[13].pressed)&&this.onLadder&&(f=!0))},this.resetPos=function(t,i){this.startX=t,this.startY=i,this.entity.x=this.startX,this.entity.y=this.startY,v(),c=0,jumping=!1,y=0,this.active=!0},this.updateHitbox=function(){v()},this.moveUp=function(){0!=y||1!=d&&1!=this.exitLadder||(this.jumping=!0,y=19,h(U,1)),this.onLadder&&(u=!0)}}function v(){this.tick=function(){et.context.font="30px Arial",et.context.fillText("Hello World",10,50),et.context.fillText("Press Space",10,100),et.keys&&et.keys[W]&&(null==e&&(e=new AudioContext),it=!0)}}getSound=function(t,i){var e;switch(t){case D:e=a(i);break;case B:e=c(i);break;case U:e=o(i);break;case V:e=r(i);break;case q:e=y(i);break;default:return 1}return e};var x=37,p=39,w=38,k=40,L=87,P=65,H=83,X=68,A=0,M=2,W=32,Y=0,S=1,T=2,G=3,I=4,R=5,O=6,C=7,E=8,N=9,j=10,D=0,B=1,U=2,V=3,q=4;function z(t,s,n){this.tiles=[],this.backTiles=[],this.coins=[],this.startX=0,this.startY=0,this.canvasHalfW=t/2,this.canvasHalfH=s/2,this.showPortal=!1,this.levels=[];var a,o=0,r=0;this.draw=function(t,e){for(i=0;i<this.backTiles.length;i++){(s=this.backTiles[i]).update(e)}for(i=0;i<this.tiles.length;i++){var s;(s=this.tiles[i]).update(e),s.tick(t)}for(i=0;i<this.coins.length;i++){var n=this.coins[i];n.update(e),n.type==T&&ft(n)&&this.active&&n.active?(h(B,1),n.active=!1,o++):n.type==E&&this.showPortal&&(n.active?n.active&&ft(n)&&(h(q,1),this.showPortal=!1,t.currentLevel++,t.active=!1,this.active=!1,4==t.currentLevel&&(t.currentLevel=0),this.reset(t)):n.active=!0)}o!=r||t.reset?t.reset&&(this.showPortal=!1,t.reset=!1,t.active=!1,this.active=!1,this.reset(t)):this.showPortal=!0},this.reset=function(t){var i=null!=t?t.currentLevel:0;r=0,o=0,this.tiles=[],this.backTiles=[],this.coins=[];var s=(a=this.levels[i]).length,n=a[0].length;for(row=0;row<s;row++)for(col=0;col<n;col++){var h;xx=32*col,yy=32*row;var c=a[row][col];[S,I,R,O,C,N,j].includes(c)?(h=new ut(32,xx,yy,c,!0,col,row,"none"),this.tiles.push(h)):c==T||c==E?(h=new ut(32,xx,yy,c,!1,col,row,"none"),this.coins.push(h),c==T&&r++):c==G&&(this.startX=xx,this.startY=yy),Math.random()>.8&&(h=new ut(32,xx,yy,Y,!1,col,row,"none"),this.backTiles.push(h))}null!=t&&t.resetPos(this.startX,this.startY),null!=e&&l(),this.active=!0},this.levels.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,4,4,4,4,0,0,0,0,0,0],[4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,1,9,9,9,1,0,0,0,7,0,0,0,0,0,0,0],[1,0,0,6,0,0,0,0,1,4,4,4,6,1,10,10,10,1,0,1],[1,0,0,6,0,0,0,0,1,0,0,0,6,1,0,2,0,0,0,1],[1,0,0,1,1,1,0,0,1,0,3,0,6,1,1,1,1,4,4,1],[1,0,0,0,0,0,0,0,1,0,0,8,0,0,0,0,0,0,2,1],[1,4,4,4,4,4,4,4,1,4,4,4,4,5,5,5,5,5,4,1]]),this.levels.push([[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,8,0],[0,3,0,0,2,2],[5,5,5,5,4,4]]),this.levels.push([[1,2,2,2,2,1],[1,2,2,2,2,1],[1,2,4,4,2,1],[1,2,8,3,2,1],[1,5,5,5,5,1]]),this.levels.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,6,0],[0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,6,0],[0,0,0,0,0,0,0,0,1,4,0,0,0,0,0,0,0,0,6,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,2,0,0,0,6,0],[1,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,6,1],[1,0,0,8,0,0,0,0,1,0,0,0,0,0,0,6,0,0,6,1],[1,0,0,4,4,4,4,4,1,0,3,0,1,1,1,6,0,0,6,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,6,0,0,6,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]])}var z,F,J,K=!1,Q=70,Z=[],$=[],_=800,tt=600,it=!1;function startGame(){J=new u(0,0),(z=new z(_,tt,1)).reset(null),F=new f(25,25,"green",z.startX,z.startY),J.newPos(F,z),v=new v,et.start()}var et={canvas:document.createElement("canvas"),start:function(){this.canvas.width=_,this.canvas.height=tt,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.body.childNodes[0]),this.frameNo=0,this.interval=setInterval(st,20),window.addEventListener("keydown",function(t){t.preventDefault(),et.keys=et.keys||[],et.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){et.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),et.keys=et.keys||[],et.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),et.keys=et.keys||[],et.keys[t.button]=!1}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){var i=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",i.index,i.id,i.buttons.length,i.axes.length),Z[t.gamepad.index]=t.gamepad})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function st(){navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,it?(et.clear(),z.draw(F,J),F.tick(J),F.newPos(z.tiles),F.update(J),J.newPos(F,z)):v.tick()}var nt="assets/wall.png",ht="assets/brick.png",at="assets/coin.png",ot="assets/ledge.png",rt="assets/ice.png",ct="assets/ladder.png",yt="assets/portal.png",dt="assets/left.png",lt="assets/leftalt.png";function ut(t,i,e,s,n,h,a,o){this.entity=new g(t,t,"null",i,e,"tile"),this.isSolid=n,this.column=h,this.row=a,this.color=o,this.image=new Image,this.collected=!1,this.type=s,this.active=!0,this.time=0,this.oneWay=!1,this.leftPush=!1,this.rightPush=!1;switch(this.type){case S:this.image.src=ht;break;case T:this.image.src=at;break;case O:this.image.src=ct,this.isSolid=!1;break;case C:this.isSolid=!1,this.entity.height=16,this.entity.y+=16;break;case I:this.image.src=ot,this.oneWay=!0;break;case Y:this.image.src=nt;break;case R:this.image.src=rt;break;case E:this.image.src=yt,this.active=!1;break;case N:this.image.src=dt,this.leftPush=!0;break;case j:this.image.src=dt,this.rightPush=!0,this.entity.angle=2*Math.PI-180*Math.PI/180}this.update=function(t){ctx=et.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.rotate(this.entity.angle),this.type==E&&this.active&&(this.time+=.001,ctx.globalAlpha=gt(this.time)),this.type!=N&&this.type!=j||!this.active||(this.time+=.01,this.time>.5?this.image.src=lt:this.image.src=dt,this.time>1&&(this.time=0)),null==this.image?(ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.entity.width,this.entity.height)):this.active&&(this.type==R?ctx.drawImage(this.image,0,this.entity.yOffset,30,30,this.entity.mhWidth,this.entity.mhHeight+this.entity.yOffset,this.entity.width,this.entity.height):ctx.drawImage(this.image,this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height)),ctx.restore()},this.tick=function(t){this.type==R&&(this.entity.yOffset>-30&&function(t,i){return null!=i.entity&&vt(t.entity.x,t.entity.y+20,t.entity.width,t.entity.height,i.entity.x,i.entity.y,i.entity.width,i.entity.height)}(t,this)?(this.time+=.8,this.entity.yOffset-=.8):this.entity.yOffset<-30&&(this.active=!1))}}function gt(t){return.5*(1+Math.sin(157*t))}function ft(t){return F.hbX<t.entity.x+t.entity.width&&F.hbX>t.entity.x&&F.hbY<t.entity.y+t.entity.height&&F.hbY>t.entity.y}function vt(t,i,e,s,n,h,a,o){return t<n+a&&t+e>n&&i<h+o&&i+s>h}