var n,h=[];function a(t,e){for(m=n.createBuffer(1,96e3,48e3),gainNode=n.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=n.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(n.destination),gainNode.gain.value=.05,s.start()}function o(t){return 2*Math.random()-1}function c(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(e,2)}function r(t){if(t>5e4)return null;var e=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(e,3)}function y(t){var e=1e4;if(t>e)return null;var i=(e-t)/e,s=Math.pow(i,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function l(){for(os of h)null!=os&&os.stop(0);for(d in h=[],data=[12,12,11,11,11,10,10,10,11,11,11,12,12,12],audio=new AudioContext,data)data[d]&&(gain=audio.createGain(),osc=audio.createOscillator(),h.push(osc),osc.connect(gain),gain.connect(audio.destination),osc.start(.4*d),osc.frequency.setValueAtTime(440*1.06**(13-data[d]),.4*d),osc.type="triangle",gain.gain.setValueAtTime(0,.4*d),gain.gain.setTargetAtTime(1e-4,.4*d+.38,.005),osc.stop(.4*d+.39))}function u(){with(new AudioContext)[6,6,6,6,6,6,6,6,6,6,8,8,9,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,20,21,21,21,22,23].map((t,i)=>{with(createOscillator())t&&(start(e=[34,38,41,44,47,52,54,56,59,62,49,51,36,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,31,33,35,37,39,41,44,46,48,50,54,56,58,60,62,64,66,55,45,62,66,64,50][i]/5,connect(destination),frequency.value=700/1.06**t),stop(e+.2))})}function g(t,e){this.entity=new f(30,30,"null",t,e,"view"),this.newPos=function(t,e){this.entity.x=parseInt(t.entity.x+t.entity.width/2-e.canvasHalfW),this.entity.y=t.entity.y+t.entity.height/2-e.canvasHalfH-z}}function f(t,e,i,s,n,h){this.type=h,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.hWidth=t/2,this.hHeight=e/2,this.yOffset=0,this.angle=0,this.x=s,this.y=n,this.color=i,this.active=!0,this.update=function(){this.active&&(ctx=F.context,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.angle),ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.width,this.height),ctx.restore())}}function x(e,s,n,h,o,c){this.entity=new f(e,s,n,h,o,"hero"),this.speed=1,this.color=n,this.startX=h,this.startY=o,this.currentLevel=1,this.active=!1,this.reset=!1,this.jumping=!1,this.onLadder=!1,this.exitLadder=!1;var r=0,y=0,d=!1,l=6,u=!1,g=!1;function x(){J.hbX=J.entity.x+J.entity.hWidth,J.hbY=J.entity.y+J.entity.hHeight/2}this.update=function(t){ctx=F.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.fillStyle=n,ctx.fillRect(this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore()},this.newPos=function(e){l=this.onLadder&&!this.exitLadder?0:6,this.hbX1=this.entity.x,this.hbY1=this.entity.y,x();var s=this.entity.x+r*this.speed,n=this.entity.y+l-y;this.onLadder&&(u&&!this.exitLadder?(n-=3,u=!1,n+=y):g&&(n+=3,g=!1)),this.exitLadder=!1,y>0?y--:this.jumping=!1;var h=!0,o=!0;for(this.onLadder=!1,i=0;i<e.length;i++)t=e[i],t.isSolid&&t.active&&dt(s,this.hbY1,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(o=!1),dt(this.hbX1,n,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(t.isSolid&&t.active?h=!1:t.type!=I&&t.type!=N||(this.onLadder=!0)),t.type==N&&dt(this.hbX1,n+30,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.exitLadder=!0);d=!h,o&&(this.entity.x=s),h&&(this.entity.y=n),this.entity.y>400&&(a(U,1),this.entity.y=this.startY,this.entity.x=this.startX,this.reset=!0)},this.tick=function(){r>0?(r-=.3)<0&&(r=0):r<0&&(r+=.3)>0&&(r=0),F.keys&&!this.jumping&&(F.keys[k]||F.keys[H]||F.keys[W])&&this.moveUp(),F.keys&&(F.keys[L]||F.keys[P])&&this.onLadder&&(g=!0),F.keys&&(F.keys[w]||F.keys[X])&&r>-3&&r--,F.keys&&(F.keys[p]||F.keys[Y])&&r<3&&r++,K.length>0&&((K[0].axes[0]<-.8||K[0].axes[2]<-.8||K[0].buttons[14].pressed)&&r>-3&&r--,(K[0].axes[0]>.8||K[0].axes[2]>.8||K[0].buttons[15].pressed)&&r<3&&r++,(K[0].axes[1]<-.8||K[0].axes[3]<-.8||K[0].buttons[12].pressed)&&this.moveUp(),(K[0].axes[1]>.8||K[0].axes[3]>.8||K[0].buttons[13].pressed)&&this.onLadder&&(g=!0))},this.resetPos=function(t,e){J.startX=t,J.startY=e,J.entity.x=J.startX,J.entity.y=J.startY,x(),J.hPower=0,J.jumping=!1,J.active=!0},this.updateHitbox=function(){x()},this.moveUp=function(){0!=y||1!=d&&1!=this.exitLadder||(this.jumping=!0,y=19,a(B,1)),this.onLadder&&(u=!0)}}function v(){this.tick=function(){F.context.font="30px Arial",F.context.fillText("Hello World",10,50),F.context.fillText("Press Space",10,100),F.keys&&F.keys[W]&&(null==n&&(n=new AudioContext),tt=!0)}}getSound=function(t,e){var i;switch(t){case D:i=o(e);break;case R:i=y(e);break;case B:i=c(e);break;case U:i=r(e);break;default:return 1}return i};var w=37,p=39,k=38,L=40,H=87,X=65,P=83,Y=68,S=0,T=2,W=32,G=0,M=1,O=2,A=3,C=4,E=5,I=6,N=7,j=8,D=0,R=1,B=2,U=3;function q(t,e,s){this.tiles=[],this.backTiles=[],this.coins=[],this.startX=0,this.startY=0,this.canvasHalfW=t/2,this.canvasHalfH=e/2,this.showPortal=!1;var h,o=0,c=0;this.draw=function(t,e){for(i=0;i<this.backTiles.length;i++){(s=this.backTiles[i]).update(e)}for(i=0;i<this.tiles.length;i++){var s;(s=this.tiles[i]).update(e),s.tick(t)}for(i=0;i<this.coins.length;i++){var n=this.coins[i];n.update(e),n.type==O&&yt(n)&&this.active&&n.active?(a(R,1),n.active=!1,o++):n.type==j&&this.showPortal&&(n.active?n.active&&yt(n)&&(console.log("level complete!"),this.showPortal=!1,t.currentLevel++,t.active=!1,this.active=!1,this.reset(t.currentLevel,t)):n.active=!0)}o==c?this.showPortal=!0:t.reset&&(t.reset=!1,t.active=!1,this.active=!1,this.reset(t.currentLevel,t))},this.reset=function(t,e){c=0,o=0,this.tiles=[],this.backTiles=[],this.coins=[],1==t?h=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,4,4,4,4,0,0,0,0,0,0],[4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,7,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,1,1,1,1,1,0,0,0,7,0,2,0,0,0,0,0],[1,0,0,6,0,0,0,0,1,4,4,0,6,1,1,1,0,0,0,1],[1,0,0,6,0,0,0,0,1,0,0,0,6,0,0,2,0,0,0,1],[1,0,0,1,1,1,0,0,1,0,3,0,1,1,1,0,0,0,0,1],[1,0,0,8,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,4,4,4,4,4,4,4,1,4,4,4,4,5,5,5,5,5,4,1]]:2==t?h=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,8,0],[0,3,0,0,2,2],[5,5,5,5,4,4]]:3==t?h=[[1,2,2,2,2,1],[1,2,2,2,2,1],[1,2,4,4,2,1],[1,2,8,3,2,1],[1,5,5,5,5,1]]:4==t&&(h=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,6,0],[0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,6,0],[0,0,0,0,0,0,0,0,1,4,0,0,0,0,0,0,0,0,6,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,2,0,0,0,6,0],[1,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,6,1],[1,0,0,8,0,0,0,0,1,0,0,0,0,0,0,6,0,0,6,1],[1,0,0,4,4,4,4,4,1,0,3,0,1,1,1,6,0,0,6,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,6,0,0,6,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],e.currentLevel=0);var i=h.length,s=h[0].length;for(row=0;row<i;row++)for(col=0;col<s;col++){var a;xx=32*col,yy=32*row;var r=h[row][col];[M,C,E,I,N].includes(r)?(a=new rt(32,xx,yy,r,!0,col,row,"none"),this.tiles.push(a)):r==O||r==j?(a=new rt(32,xx,yy,r,!1,col,row,"none"),this.coins.push(a),r==O&&c++):r==A&&(this.startX=xx,this.startY=yy),Math.random()>.8&&(a=new rt(32,xx,yy,G,!1,col,row,"none"),this.backTiles.push(a))}null!=e&&e.resetPos(this.startX,this.startY),null!=n&&l(),this.active=!0}}var V=!1,z=70,F,q,J,K=[],Q=[],Z=800,$=600,_,tt=!1;function startGame(){_=new g(0,0),(q=new q(Z,$,1)).reset(1),J=new x(25,25,"green",q.startX,q.startY),_.newPos(J,q),v=new v,F.start()}var F={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Z,this.canvas.height=$,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.body.childNodes[0]),this.frameNo=0,this.interval=setInterval(et,20),window.addEventListener("keydown",function(t){t.preventDefault(),F.keys=F.keys||[],F.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){F.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),F.keys=F.keys||[],F.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),F.keys=F.keys||[],F.keys[t.button]=!1}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){var e=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.index,e.id,e.buttons.length,e.axes.length),K[t.gamepad.index]=t.gamepad})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function et(){navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,tt?(F.clear(),q.draw(J,_),J.tick(_),J.newPos(q.tiles),J.update(_),_.newPos(J,q)):v.tick()}var it="assets/wall.png",st="assets/brick.png",nt="assets/coin.png",ht="assets/ledge.png",at="assets/ice.png",ot="assets/ladder.png",ct="assets/portal.png";function rt(t,e,i,s,n,h,a,o){this.entity=new f(t,t,"null",e,i,"tile"),this.isSolid=n,this.column=h,this.row=a,this.color=o,this.image=new Image,this.collected=!1,this.type=s,this.active=!0,this.time=0;switch(this.type){case M:this.image.src=st;break;case O:this.image.src=nt;break;case I:this.image.src=ot,this.isSolid=!1;break;case N:this.isSolid=!1,this.entity.height=16,this.entity.y+=16;break;case C:this.image.src=ht;break;case G:this.image.src=it;break;case E:this.image.src=at;break;case j:this.image.src=ct,this.active=!1}this.update=function(t){ctx=F.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.rotate(this.angle),null==this.image?(ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.entity.width,this.entity.height)):this.active&&(this.type==E?ctx.drawImage(this.image,0,this.entity.yOffset,30,30,this.entity.mhWidth,this.entity.mhHeight+this.entity.yOffset,this.entity.width,this.entity.height):ctx.drawImage(this.image,this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height)),ctx.restore()},this.tick=function(t){this.type==E&&(this.entity.yOffset>-30&&function(t,e){return null!=e.entity&&dt(t.entity.x,t.entity.y+20,t.entity.width,t.entity.height,e.entity.x,e.entity.y,e.entity.width,e.entity.height)}(t,this)?(this.time+=.8,this.entity.yOffset-=.8):this.entity.yOffset<-30&&(this.active=!1))}}function yt(t){return J.hbX<t.entity.x+t.entity.width&&J.hbX>t.entity.x&&J.hbY<t.entity.y+t.entity.height&&J.hbY>t.entity.y}function dt(t,e,i,s,n,h,a,o){return t<n+a&&t+i>n&&e<h+o&&e+s>h}