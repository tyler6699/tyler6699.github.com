var level,hero,camera,debug=!1,offset=100,controllers=[],buttonsPressed=[],canvasW=800,canvasH=600;function startGame(){camera=new Camera(0,0),(level=new level(canvasW,canvasH,1)).reset(1),hero=new heroObj(25,25,"green",level.startX,level.startY),camera.newPos(hero,level),mainGame.start()}var mainGame={canvas:document.createElement("canvas"),start:function(){this.canvas.width=canvasW,this.canvas.height=canvasH,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.body.childNodes[0]),this.frameNo=0,this.interval=setInterval(updateGameArea,20),window.addEventListener("keydown",function(e){e.preventDefault(),mainGame.keys=mainGame.keys||[],mainGame.keys[e.keyCode]="keydown"==e.type}),window.addEventListener("keyup",function(e){mainGame.keys[e.keyCode]="keydown"==e.type}),window.addEventListener("mousedown",function(e){e.preventDefault(),mainGame.keys=mainGame.keys||[],mainGame.keys[e.button]=!0}),window.addEventListener("mouseup",function(e){e.preventDefault(),mainGame.keys=mainGame.keys||[],mainGame.keys[e.button]=!1}),this.canvas.oncontextmenu=function(e){e.preventDefault()},window.addEventListener("gamepadconnected",function(e){var a=navigator.getGamepads()[e.gamepad.index];console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",a.index,a.id,a.buttons.length,a.axes.length),controllers[e.gamepad.index]=e.gamepad})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function updateGameArea(){hero.reset&&(hero.reset=!1,level.reset(hero.currentLevel)),navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads&&navigator.webkitGetGamepads,mainGame.clear(),level.draw(hero,camera),hero.tick(camera),hero.newPos(level.tiles),hero.update(camera),camera.newPos(hero,level)}